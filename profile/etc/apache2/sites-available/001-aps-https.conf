################################################################################
# Main Site configuration
################################################################################

# Logging Directives
LogLevel warn
CustomLog "|$/bin/sed -u -E \'s/csc=[^& ]*/csc=\[MASKED\]/g\' | /usr/bin/logger -thttpd -plocal6.notice" combined
ErrorLog  "|/usr/bin/logger -thttpd -plocal6.err"

# VirtualHost configuration
DocumentRoot /var/www/html

################################################################################
### Default Apache site - Redirects
################################################################################
<VirtualHost *:80>
    # Rewrite all non-provisioning requests
    RewriteEngine On
    # Stop internal redirection
    RewriteCond %{ENV:REDIRECT_STATUS} !200
    # Redirect all request to https://
    RewriteRule ^.*$ https://%{HTTP_HOST}%{REQUEST_URI} [L]
</VirtualHost>

################################################################################
### SSL Apache Site
################################################################################
<VirtualHost *:443>
    # Portal certificates
    SSLEngine on
    SSLCertificateFile    /etc/ssl/certs/ssl-demo-public.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-demo-private.key
    Protocols h2 h2c http/1.1
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RedirectMatch ^/$ /demo/
     </IfModule>
</VirtualHost>
